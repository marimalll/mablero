{% extends "main/base.html" %}
{% load static %}
{% load goods_tags %}
{% block content %}
    <main class="catalog container">
        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Введите нужный товар...">
                <button class="search-btn">Найти</button>
            </div>
        </div>
        <!--Форма фильтров -->
        <div class="filter-group mb-3">
        <div class="dropdown">
            <button class="btn filter-toggle btn-outline-dark" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-funnel me-1"></i>Фильтры и сортировка
            </button>

            <form action="{% url "catalog:index" slug_url %}" method="get" class="dropdown-menu p-3 bg-dark shadow-lg" data-bs-theme="dark" style="min-width: 280px;">
                <!-- Сохранение поискового запроса -->
                <!-- <input type="hidden" name="q" value="{{ request.GET.q|default:'' }}"> -->

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" name="on_sale" id="saleCheck" value="on" {% if request.GET.on_sale == 'on' %}checked{% endif %}>
                    <label class="form-check-label text-white" for="saleCheck">
                        Только товары по акции
                    </label>
                </div>

                <hr class="dropdown-divider bg-light opacity-25 my-2">

                <small class="text-white-50 mb-2 d-block">Сортировка по цене:</small>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="order_by" id="sortDefault" value="default" {% if not request.GET.order_by or request.GET.order_by == 'default' %}checked{% endif %}>
                    <label class="form-check-label text-white" for="sortDefault">По умолчанию</label>
                </div>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="order_by" id="sortAsc" value="price" {% if request.GET.order_by == 'price' %}checked{% endif %}>
                    <label class="form-check-label text-white" for="sortAsc">Сначала дешевые</label>
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="radio" name="order_by" id="sortDesc" value="-price" {% if request.GET.order_by == '-price' %}checked{% endif %}>
                    <label class="form-check-label text-white" for="sortDesc">Сначала дорогие</label>
                </div>

                <hr class="dropdown-divider bg-light opacity-25 my-3">

                <button type="submit" class="btn btn-primary w-100 py-2 fw-semibold">
                    <i class="bi bi-check-circle me-1"></i>Применить фильтры
                </button>

                {% if request.GET %}
                <a href="{% url "catalog:index" slug_url %}" class="btn btn-outline-light w-100 py-1 mt-1 text-decoration-none small">
                    Сбросить все
                </a>
                {% endif %}
            </form>
            </div>
        </div>




        <section id="living-room" class="product-list">

            {% for product in goods %}
            <div class="sofas">
            <div class="product-card">
                {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{product.name}}" />
                {% else %}
                    <img src="{% static "deps/img/furniture_shop_img/Image-not-found.png" %}" alt="{{product.name}}" />

                {% endif %}
                    <a href="{% url "catalog:product" product.slug %}">
                    <h3>{{product.name}}</h3>
                   </a>
                    <p>{{product.description}}</p>
                    <p class="product_id">артикул: {{product.display_id}}</p>
                    {% if product.discount %}
                    <p><s>{{product.price}} ₽</s></p>
                    <p><strong>{{product.sell_price}} ₽</strong></p>
                    {% else%}
                    <span class="price">{{product.price}}₽</span>
                    {% endif %}
                    <button class="btn-mn">Добавить в корзину</button>
            </div>
                </div>
            {% endfor %}

        </section>
    </main>
<!-- Пагинация -->
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center my-4">
            <div class="custom-shadow d-flex">
                <li class="page-item {% if not goods.has_previous %}disabled{% endif%}">
                  <a class="page-link" href="{%if goods.has_previous %}?{% change_params page=goods.previous_page_number %}
                  {% else %}#{% endif%}">предыдущая</a>
                </li>
                {% for page in goods.paginator.page_range %}
                {% if page >= goods.number|add:-2 and page <= goods.number|add:2 %}
                    <li class="page-item" {% if goods.number == page %} active {% endif %}>
                       <!-- надо так же через параметры сделать каталог как раньше -->
                        <a class="page-link" href="?{% change_params page=page %}">{{page}}</a>
                    </li>
                {% endif %}
                {% endfor %}
                  <li class="page-item {% if not goods.has_next %}disabled{% endif%}">
                  <a class="page-link" href="{%if goods.has_next %}?{% change_params page=goods.next_page_number %}
                  {% else %}#{% endif %}">следующая</a>
                </li>
            </div>
        </ul>
    </nav>
{% endblock content %}